{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"C:\\\\Users\\\\admin\\\\Downloads\\\\cchproject-main 2\\\\cchproject-main\\\\components\\\\profile\\\\AdminOrderItem.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport { toast } from 'react-toastify';\nimport Image from 'next/image';\nimport Link from 'next/link';\nimport moment from 'moment';\nimport { firebaseClient } from '../../firebase/firebaseClient';\nimport FileUploader from \"react-firebase-file-uploader\";\nexport default function OrderItem({\n  order,\n  tabs\n}) {\n  const firestore = firebaseClient.firestore();\n  const storage = firebaseClient.storage();\n  const statusSelectRef = useRef();\n  const {\n    0: state,\n    1: setState\n  } = useState({\n    orderStatus: '',\n    showDetail: false,\n    isUploading: false,\n    progress: 0,\n    videoURL: ''\n  });\n  useEffect(() => {\n    setState(_objectSpread(_objectSpread({}, state), {}, {\n      orderStatus: order.status,\n      videoURL: order.videoURL\n    }));\n  }, []);\n\n  const changeStatus = () => {\n    if (statusSelectRef.current.value === 'finished' && !state.videoURL) {\n      toast.warn(\"Upload a video\");\n      return;\n    }\n\n    firestore.collection('orders').doc(order.orderId).update({\n      status: statusSelectRef.current.value\n    }).then(() => {\n      setState(_objectSpread(_objectSpread({}, state), {}, {\n        orderStatus: statusSelectRef.current.value\n      }));\n      toast.success('Successfully changed!');\n    }).catch(err => console.log(err));\n  };\n\n  const handleUploadStart = () => {\n    toast.info(\"Upload starting...\");\n    setState(_objectSpread(_objectSpread({}, state), {}, {\n      isUploading: true,\n      progress: 0\n    }));\n  };\n\n  const handleUploadError = error => {\n    console.log(error, 'upload error');\n    setState(_objectSpread(_objectSpread({}, state), {}, {\n      isUploading: false\n    }));\n  };\n\n  const handleUploadSuccess = async filename => {\n    try {\n      const videoURL = await storage.ref(\"videos\").child(filename).getDownloadURL();\n      const metadata = await storage.ref(\"videos\").child(filename).getMetadata();\n      let size = '';\n\n      if (metadata.size > 1048576) {\n        size = (metadata.size / 1048576).toFixed(2) + 'Mb';\n      } else {\n        size = (metadata.size / 1024).toFixed(2) + 'Kb';\n      }\n\n      await firestore.collection('orders').doc(order.orderId).update({\n        videoURL,\n        videoSize: size\n      });\n      setState(_objectSpread(_objectSpread({}, state), {}, {\n        progress: 100,\n        isUploading: false,\n        videoURL\n      }));\n      toast.success(\"Video uploaded successfuly!\");\n    } catch (error) {\n      setState(_objectSpread(_objectSpread({}, state), {}, {\n        progress: 0,\n        isUploading: false\n      }));\n      console.log(error);\n    }\n  };\n\n  const handleProgress = progress => {\n    setState(_objectSpread(_objectSpread({}, state), {}, {\n      progress: progress,\n      isUploading: true\n    }));\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: tabs.includes(state.orderStatus) ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"order-item\",\n      children: [state.videoURL && state.orderStatus === 'finished' ? /*#__PURE__*/_jsxDEV(Link, {\n        href: {\n          pathname: '/order',\n          query: {\n            orderId: order.orderId\n          }\n        },\n        children: /*#__PURE__*/_jsxDEV(\"a\", {\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"order-image\",\n            children: [/*#__PURE__*/_jsxDEV(\"img\", {\n              src: order.orderImage,\n              alt: \"\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 94,\n              columnNumber: 23\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"play-icon\",\n              children: /*#__PURE__*/_jsxDEV(\"svg\", {\n                width: \"106\",\n                height: \"107\",\n                viewBox: \"0 0 106 107\",\n                fill: \"none\",\n                xmlns: \"http://www.w3.org/2000/svg\",\n                children: [/*#__PURE__*/_jsxDEV(\"path\", {\n                  d: \"M103.647 53.9141C103.647 82.406 80.8026 105.475 52.6564 105.475C24.5103 105.475 1.66565 82.406 1.66565 53.9141C1.66565 25.4222 24.5103 2.35275 52.6564 2.35275C80.8026 2.35275 103.647 25.4222 103.647 53.9141Z\",\n                  stroke: \"white\",\n                  strokeWidth: \"3\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 97,\n                  columnNumber: 27\n                }, this), /*#__PURE__*/_jsxDEV(\"path\", {\n                  d: \"M39.8408 31.9509L76.7631 53.9141L39.8408 75.8773L39.8408 31.9509Z\",\n                  stroke: \"white\",\n                  strokeWidth: \"3\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 100,\n                  columnNumber: 27\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 96,\n                columnNumber: 25\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 95,\n              columnNumber: 23\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 93,\n            columnNumber: 21\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 19\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 17\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"order-image\",\n        children: /*#__PURE__*/_jsxDEV(\"img\", {\n          src: order.orderImage,\n          alt: \"\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 108,\n          columnNumber: 19\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"userinfo\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"creator\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Creator:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 113,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n            className: \"artist-name\",\n            children: order.title\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 114,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 112,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"useremail\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"For:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 119,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n            className: \"artist-name\",\n            children: order.customerEmail\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 120,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 118,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"actions\",\n        children: [/*#__PURE__*/_jsxDEV(\"select\", {\n          name: \"\",\n          id: \"\",\n          defaultValue: order.status,\n          ref: statusSelectRef,\n          children: [/*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"placed\",\n            children: \"Order Placed\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 127,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"accepted\",\n            children: \"Order Accepted\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 128,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"pending\",\n            children: \"Order is prepareing\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 129,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"finished\",\n            children: \"Order is ready\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 130,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 126,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: changeStatus,\n          children: \"Change Status\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 132,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: `details ${state.showDetail ? 'opened' : ''}`,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"buttons\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"toggle-order\",\n            onClick: () => setState(_objectSpread(_objectSpread({}, state), {}, {\n              showDetail: !state.showDetail\n            })),\n            children: \"See order details\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 136,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n            htmlFor: order.orderId,\n            className: \"upload\",\n            children: [state.isUploading ? 'Uploading... ' + state.progress + '%' : state.videoURL ? 'Video Uploaded' : 'Upload video', /*#__PURE__*/_jsxDEV(FileUploader, {\n              accept: \"video/*\",\n              id: order.orderId,\n              filename: file => order.title.toLowerCase().split(' ').join('-') + '-' + new Date().getTime(),\n              storageRef: firebase.storage().ref(\"videos\"),\n              onUploadStart: handleUploadStart,\n              onUploadError: handleUploadError,\n              onUploadSuccess: handleUploadSuccess,\n              onProgress: handleProgress\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 146,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 139,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 135,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"detail-content\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"row\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"left\",\n              children: \"Who is this for:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 160,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"right\",\n              children: order.forwhom\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 161,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 159,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"row\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"left\",\n              children: \"From\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 164,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"right\",\n              children: order.from\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 165,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 163,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"row\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"left\",\n              children: \"To\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 168,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"right\",\n              children: order.to\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 169,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 167,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"row\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"left\",\n              children: \"Occation\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 172,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"right\",\n              children: order.occasion\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 173,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 171,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"row\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"left\",\n              children: \"Instruction\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 176,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"right\",\n              children: order.instructions\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 177,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 175,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"row\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"left\",\n              children: \"Date\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 180,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"right\",\n              children: moment.unix(order.createdAt._seconds).format(\"MM/DD/YYYY\")\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 181,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 179,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 158,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 11\n    }, this) : null\n  }, void 0, false);\n}","map":{"version":3,"sources":["C:/Users/admin/Downloads/cchproject-main 2/cchproject-main/components/profile/AdminOrderItem.js"],"names":["React","useState","useEffect","useRef","toast","Image","Link","moment","firebaseClient","FileUploader","OrderItem","order","tabs","firestore","storage","statusSelectRef","state","setState","orderStatus","showDetail","isUploading","progress","videoURL","status","changeStatus","current","value","warn","collection","doc","orderId","update","then","success","catch","err","console","log","handleUploadStart","info","handleUploadError","error","handleUploadSuccess","filename","ref","child","getDownloadURL","metadata","getMetadata","size","toFixed","videoSize","handleProgress","includes","pathname","query","orderImage","title","customerEmail","file","toLowerCase","split","join","Date","getTime","firebase","forwhom","from","to","occasion","instructions","unix","createdAt","_seconds","format"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { toast } from 'react-toastify';\nimport Image from 'next/image';\nimport Link from 'next/link';\nimport moment from 'moment';\nimport { firebaseClient } from '../../firebase/firebaseClient';\nimport FileUploader from \"react-firebase-file-uploader\";\n\nexport default function OrderItem({ order, tabs }) {\n  const firestore = firebaseClient.firestore();\n  const storage = firebaseClient.storage();\n  const statusSelectRef = useRef();\n\n  const [state, setState] = useState({\n    orderStatus: '',\n    showDetail: false,\n    isUploading: false,\n    progress: 0,\n    videoURL: ''\n  });\n\n  useEffect(() => {\n    setState({ ...state, orderStatus: order.status, videoURL: order.videoURL });\n  }, [])\n\n  const changeStatus = () => {\n    if (statusSelectRef.current.value === 'finished' && !state.videoURL) {\n      toast.warn(\"Upload a video\");\n      return\n    }\n\n    firestore.collection('orders')\n      .doc(order.orderId)\n      .update({ status: statusSelectRef.current.value })\n      .then(() => {\n        setState({ ...state, orderStatus: statusSelectRef.current.value })\n        toast.success('Successfully changed!')\n      })\n      .catch(err => console.log(err))\n  }\n\n  const handleUploadStart = () => {\n    toast.info(\"Upload starting...\")\n    setState({ ...state, isUploading: true, progress: 0 })\n  }\n\n  const handleUploadError = (error) => {\n\n    console.log(error, 'upload error')\n    setState({ ...state, isUploading: false })\n  }\n\n  const handleUploadSuccess = async (filename) => {\n    try {\n      const videoURL = await storage\n        .ref(\"videos\")\n        .child(filename)\n        .getDownloadURL()\n\n      const metadata = await storage.ref(\"videos\").child(filename).getMetadata();\n\n      let size = ''\n\n      if (metadata.size > 1048576) {\n        size = (metadata.size / 1048576).toFixed(2) + 'Mb';\n      } else {\n        size = (metadata.size / 1024).toFixed(2) + 'Kb';\n      }\n\n      await firestore.collection('orders').doc(order.orderId).update({ videoURL, videoSize: size })\n\n      setState({ ...state, progress: 100, isUploading: false, videoURL });\n      toast.success(\"Video uploaded successfuly!\")\n    } catch (error) {\n      setState({ ...state, progress: 0, isUploading: false });\n      console.log(error)\n    }\n  }\n\n  const handleProgress = progress => {\n    setState({ ...state, progress: progress, isUploading: true })\n  }\n\n  return (\n    <>\n      {\n        tabs.includes(state.orderStatus) ?\n          <div className=\"order-item\">\n            {\n              state.videoURL && state.orderStatus === 'finished' ?\n                <Link href={{ pathname: '/order', query: { orderId: order.orderId } }}>\n                  <a>\n                    <div className=\"order-image\">\n                      <img src={order.orderImage} alt=\"\" />\n                      <div className=\"play-icon\">\n                        <svg width=\"106\" height=\"107\" viewBox=\"0 0 106 107\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                          <path\n                            d=\"M103.647 53.9141C103.647 82.406 80.8026 105.475 52.6564 105.475C24.5103 105.475 1.66565 82.406 1.66565 53.9141C1.66565 25.4222 24.5103 2.35275 52.6564 2.35275C80.8026 2.35275 103.647 25.4222 103.647 53.9141Z\"\n                            stroke=\"white\" strokeWidth=\"3\" />\n                          <path d=\"M39.8408 31.9509L76.7631 53.9141L39.8408 75.8773L39.8408 31.9509Z\" stroke=\"white\" strokeWidth=\"3\" />\n                        </svg>\n                      </div>\n                    </div>\n                  </a>\n                </Link>\n                :\n                <div className=\"order-image\">\n                  <img src={order.orderImage} alt=\"\" />\n                </div>\n            }\n            <div className=\"userinfo\">\n              <div className=\"creator\">\n                <p>Creator:</p>\n                <h4 className=\"artist-name\">\n                  {order.title}\n                </h4>\n              </div>\n              <div className=\"useremail\">\n                <p>For:</p>\n                <h4 className=\"artist-name\">\n                  {order.customerEmail}\n                </h4>\n              </div>\n            </div>\n            <div className=\"actions\">\n              <select name=\"\" id=\"\" defaultValue={order.status} ref={statusSelectRef}>\n                <option value=\"placed\">Order Placed</option>\n                <option value=\"accepted\">Order Accepted</option>\n                <option value=\"pending\">Order is prepareing</option>\n                <option value=\"finished\">Order is ready</option>\n              </select>\n              <button onClick={changeStatus}>Change Status</button>\n            </div>\n            <div className={`details ${state.showDetail ? 'opened' : ''}`}>\n              <div className=\"buttons\">\n                <button className=\"toggle-order\" onClick={() => setState({ ...state, showDetail: !state.showDetail })}>\n                  See order details\n          </button>\n                <label htmlFor={order.orderId} className=\"upload\">\n                  {\n                    state.isUploading ?\n                      'Uploading... ' + state.progress + '%'\n                      :\n                      state.videoURL ? 'Video Uploaded' : 'Upload video'\n                  }\n                  <FileUploader\n                    accept=\"video/*\"\n                    id={order.orderId}\n                    filename={file => order.title.toLowerCase().split(' ').join('-') + '-' + new Date().getTime()}\n                    storageRef={firebase.storage().ref(\"videos\")}\n                    onUploadStart={handleUploadStart}\n                    onUploadError={handleUploadError}\n                    onUploadSuccess={handleUploadSuccess}\n                    onProgress={handleProgress}\n                  />\n                </label>\n              </div>\n              <div className=\"detail-content\">\n                <div className=\"row\">\n                  <span className=\"left\">Who is this for:</span>\n                  <span className=\"right\">{order.forwhom}</span>\n                </div>\n                <div className=\"row\">\n                  <span className=\"left\">From</span>\n                  <span className=\"right\">{order.from}</span>\n                </div>\n                <div className=\"row\">\n                  <span className=\"left\">To</span>\n                  <span className=\"right\">{order.to}</span>\n                </div>\n                <div className=\"row\">\n                  <span className=\"left\">Occation</span>\n                  <span className=\"right\">{order.occasion}</span>\n                </div>\n                <div className=\"row\">\n                  <span className=\"left\">Instruction</span>\n                  <span className=\"right\">{order.instructions}</span>\n                </div>\n                <div className=\"row\">\n                  <span className=\"left\">Date</span>\n                  <span className=\"right\">{moment.unix(order.createdAt._seconds).format(\"MM/DD/YYYY\")}</span>\n                </div>\n              </div>\n            </div>\n          </div>\n          :\n          null\n      }\n    </>\n  )\n}"]},"metadata":{},"sourceType":"module"}